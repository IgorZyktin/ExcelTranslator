# -*- coding: utf-8 -*-

"""Тесты простейшей арифметики.
"""

import pytest

from exceltranslator.lexer.lexer import Lexer
from exceltranslator.parser.parser import Parser
from exceltranslator.parser.serialization import serialize_to_python
from exceltranslator.tools import custom_eval


@pytest.fixture()
def builder():
    lexer = Lexer()
    builder = Parser(lexer)
    return builder


@pytest.fixture()
def input_data_basic():
    return {
        '2 - (2) + 4': 4,
        '2 - (2) * 4': -6,
        '1 + 1': 2,
        '(9 + 1) * 2': 20,
        '7 * 3': 21,
        '(2 + 7)': 9,
        '(3 * 7)': 21,
        '3 + 5 + 7': 15,
        '(3 * 5) * 9': 135,
        '9 * (3 * 5)': 135,
        '(1 + 2) + (5 - 4)': 4,
        '(1 + 2) * 2': 6,
        '(1 + 2) * (5 * 3)': 45,
        '4 * 9 - 8 - 7': 21,
        '2 * 7 * 9 * 2 - 1 * 2 - 25 - 3 + 60 - 0 - 6 * 4': 258,
        '2 - (1 * 2) + 4': 4,
        '6 * -1': -6,
        '-1 * 2': -2,
        '(-1 * 2) * 2 * 3 * 4 * (3 * 6 * 9 * 7)': -54432,
        '1 + 2 + 3 + 4 + 5 + 6 + 7 + 8 * 9': 100,
        '9 * 8 * 7 * 6 * 5 * 4 * 3 * 2 * 1 * -1': -362880,
        '(9 * 8 * (7 + 6)) * (5 * 4 + 3 * 2 * 1 * -1)': 13104,
        '((((9 * 8 * (7 + 6)) * (5 * 4 + 3 * 2 * 1 * -1))))': 13104,
        '((123+8*13+9-117*106)-104+6+98)*39-17+149-7+110*22*107*17-6+65+32': 3927722,
        '((762*560+1019+2027-592)+1961)+215*1746'
        '-(99+441*1202+683)*95+193+1608-1328+(673-1261-1342-419)': -49627431,
        '135+143+10*87-78*(43+107+149-(105)-67+(16+22+70-102*79)*45)+30+32*27+108': 27896744,
        '144*14-10*145*(148+48-(24+86)+133*62)*7+117-(134-(31-(139*12*20-131-59+105)))': -84601045,
        '118*47+96*23-76-109*43+38-45*3+70*(1+(111*39*92+110-12-41)+3*(0))': 27885714,
        '98-83-(148+82*(67-14-65)+114+5-(129-142-54-134+119+11*61-(125*112*145+(26))))': -2028705,
        '(((126*5-57*26-94-50-129*(126-1)+34-54)-28-(110*21)+135-74)+11*110-88)*69': -1262424,
        '15+(63+89-75-97*7-116-92)+40*(87)*83-139+80-(28)*56+72-136*25-2*22': 283046,
        '((91-69+43*143)+88)-117*62*54*41*108-(115)+10*22*76-145*5-86*26*(114*82)': -1755398437,
        '61+34-82*83-32*64-15-(30*76-22*28+60-45-76-41-52*24+48*50+86)': -11574,
        '(((28*68-53-15+15*97+5*6+56-57*6)+26*81-63-19-71+61)+94-74)+28': 5097,
        '38*90-71-43+72-64*0+26-15+98+(76-61-8-6+(96)*25-62*49)*69+20': -40446,
        '(5+83+75+26*34+3-42*75-86)+55-(41*82+(28-77)-63)*20-96+(72*63-14)': -62705,
        '70*87-75-87*45-97+24-65*28+93*76-24*11-24*(23*19-58-63+21)*42': -332685,
        '(((86+49)*46*24+53*32*22*84-42-61*49*37*98-56*59-74+34+46)-59)-56': -7558321,
        '39*19+62+(55-3+32-34+(15+76-46+82-93-76*54+20*26-54-9)+80+6)': -2674,
        '(89+47*(15+54+0)*43+(24-88+41-37-96+(95-23-27)+73)*64-46)+21-18*46': 136253,
        '((28+(35*71-24+15)-46+(40+50)+7-73-27*30-29)-92+2+26-18)*78*(92*93)': 1041761448,
        '((41*(4-87-73-10-82+70+26-(77)*20)+11-30)*55*9+57-92-65+30*26)+35': -34347830,
        '81*(62-63*54+80-67)*37+82*38-53+75+50+44+71*16*46*95+55*0-62': -5003529,
        '((94*94+93*4+74*96*72+12*31+28)*30-65*30-33-77*89)-82-(19-64)-39': 15623968,
        '(75-(25+84*1+86)+47-18)*27*0+21*(41+89+(53+66*66+20*46*67*3)+71)': 3980130,
        '(40-84+74*26*20)-21*57-(11)+64+(15-18*63+7-(70*25+17+91-84*(85+59)))': 46418,
        '(5-85-32*70)+24*69*(87-20-(37+0+80*72*72)-45-(49*28*24+32*68*23))': -824211736,
        '(77*82*92)-16-83+83*8*(0*92)+29-36*90*34-85-(88-73*11-70*46-13)': 474521,
        '((60+26*47+45*(56*97+92)-73-59+29-42*78+27)*39-88)+16-49-44*75+(43)': 9610512,
        '59*67-26*29*94-40-75*61*(21-89-(42-(86+39*30+15-40-35)+73*71-87))': 18278787,
        '((4+99+14*49*16*49-47*45-43+21-74-4)-30)*66-53-(44*72*73*32)+22': 27954533,
        '((74-86*64)*49*96+15+36+51)*44+(48+47+26+32-34-46-82-26*41+6-51)': -1123876312,
        '(3*83*16-59*74+50-(95*42)*77-(47-58*72+74)*68*49+55-66)*2+47*63': 26410335,
        '(80*57*4+30-(56*89-92-20*92)*52*39-19*69+47)+85-(50+34+41-56)+18': -6172416,
        '18+49+38*(72-(97-47-74)-95*59*36-43+57*58)+36*(93+14+65+8*13+57)': -7527943,
        '((51+14*63+28+8+47*65)-23+90-22-28+13*76+57*98+75)*56-36+93+47': 598744,
        '59*32-88+6+24-85+36*23-(60-(87+60+78*61+(60+(97-8*19-(55*78+60)))))': 3073,
        '(86+83+66)*18*59*5+99+10*(60)*51*29-(84*14+16*9+47)+48*86+(38*14)': 2138642,
        '35-(16*89*66)-38-(96-31+41+15+(39-(27-90)-21-39)-66+17)+86+39+37*71': -91349,
        '(2*33*42+83*57*82+40-38*49*48+95+78*93-90)*39+15-21+(50*(40)*86)': 12208837,
        '23*35*13+(48-78*80-26-99+39+26-52*29+52-85+9+(8*94*96+41)-43)': 74871,
        '17+83+(50)*93+77-52*8*85*88-88+63*(48*98+8+38)+28*69+96+48*(17)': -2804847,
        '(20-50*(47-80*73+72)-21)+31+52-44-60+25-(49-42+27-89*74*41*31*98)': 820625007,
        '(((23+91+99)+62*76+73)*86-59*36*30+48+62-(71-67*29-30*92)-5*47)+95': 370710,
        '74+87*57*21-(65+37+27-(97*27*47-43-14)*97-(51*45+98*71*(47-83*7)))': 8325299,
        '37-(17+70-25+95+5*46+77*41+(11+(87+(30)+63*88*76*(76+89+(25*72+65)))))': -855331955,
        '((46+32-(70+(66)-57-39*93+74*72+16)+67-13*38-13-74*82+33)+8)*41-29': -335614,
        '(60+83-14-23-36-1+13)-4-84+68*(70*59+27+11-33-46*89-(71*4)+51)': -13062,
        '(50+95)-0-(15+20-80-15+80*71-55-5*60+57+8*64-70*85-56-30+36)': 311,
        '((45+83*57+(95-(78)*40-12+65+8*47)-26)-24)*0*62-98+(92+16+6*54+25)': 359,
        '((66+8-21-47*5*26)+58+77+74*25-85+38)+94*40*57+13-71+58*(66+89)': 219133,
        '((18-39*93*5+(96)-26+17)+30)+33+12-43+81+(97*89-93*9+35-83+8)+60': -10101,
        '(26-89+67+61*74*90)-79+(90+24+69*51-43-81-48-(17-21+17*23-(60-(24))))': 409295,
        '((31-52-88+68-4)+41*9+36-52*47*70)-8+(72-45*78*32*(91+84+19*85))': -201223456,
        '91-62+89+1+12-93-22*94+95+(46+28*27-10)*14+3+88+64-46*17+91': 8617,
        '(70*17+71)*70*15-29+18-37+79-(45*37*33)*38*22-73+1*34-62+16-34': -44610058,
        '(27-78+85)*91-(82)-76-29*54+41*55+99*12-91*36-38*56*27-98-65+56': -56026,
        '((89-83*60)+45-(49*64)*7-71*34*80)+48*80*(72-7-0+93+63+12-50)+36': 482838,
        '((40-42+(11)*50+42-30+77*32*58+5)+87*98-90)-64-76-49-16+50*93*51': 388858,
        '(8-15+42+37+33)*29-95+(11+75*59+26-31+84-27+72-(50+3+53*51-0))': 4754,
        '(10-80-23)*39+4*0*38-85-67+46+23-18-10+(66+75)-73-49-(42+19)-50': -3830,
        '(68+18-48)-99*84+(96-20+(61+71-72+3-59+78-41*43*88+(43-66-28-31)))': -163346,
        '(28+14*52*(49*88*42-55)-12+44+43+29)-89*25+29-59-37-52+(39*66*48)': 131925012,
        '97*94-35+34+25*96*72*67-(14*12-32-73*46*96-16)+96*32-78+(24)*26': 11912583,
        '(32*69+14*92)-63*(95+9*(97*4-44+1+3+28+94)*62-2-52)+83*25*45': -16428092,
        '64-19-66+11-(13+22-(99*34+83-1*3-56+99-81*41-34+45-56-(56+33)))': -11,
        '80*25+65+(8*22+60-6+78+80*31)+24+(72+69+79-18*25)*48+82-99-0': -6180,
        '(((99*47+60*66)*9)-38-45*86+19-17*79)+0-2*88*12-52+43-(24*16+59)': 69721,
        '4-76*(18*16+93-(10*20*68-25-87*40+38-90-53+28*11)-52-51)-14-41': 761469,
        '(1*26-56+22*39)+42*79-47+68*24+32+(18-47*3*(60+(90*84)-58)+69)*42': -44772747,
        '(((7*13-20)+87-42+80)+44*56)*34-46-96-76+89+83-67+53*18+48+81*58': 96027,
        '((((72+47+53-54)*37-56*(14)*97*93-21*32+92*42+29)-25)*96+6-61*37)-49': -678232892,
        '((((93+5-29-60*5)-42+16+(23+(39)+71)+0-46*(17)+10+44)+2)*27)+44*4*26': -18374,
        '41+(17*92-29-97*65+60+(83-73+61-71+(70-44+76-50*10+99)-49+19+15))': -4983,
        '33-6*84*88-23*95-60*(2+14-65-58*30-78-(83*4-29+61)*22-63-12)': 550496,
        '72*8-67*58*67+30+76+68*5+31*85*86-29-81*(75*34*3-(17-90-56))': -662858,
        '(49+19+94)-12-(10-40+(44+81-(11-4+84)-9*98-32-93+57-76+39+(98-(35))))': 1070,
        '((39+55+0*62)+47+23-70*9*87+70-81+87*20-35*18+65-56*24)*28-(25)': -1535153,
        '50*(39+89-33)+71-23-9+54+83*(53-6)*41-63+(9)*91-(69*83-90-58-74)': 160035,
        '(15*37*92+71)*89+(80-51*(73-97-(3*49-53*92+67-13*67+(53*(85+8)-39))))': 4519170,
        '((78*58)*10*38-78-96)-12-10-34*38*(73*4*43-51*88+33*82*(78-20+88))': -519143124,
        '(((55+46*89-38+30)*0-48+12)-83*10+78)*76+84-13+(25+35*47*43)-52*(25)': 9643,
        '(25-4*27)-42*32+2*18+13*1-23*82-73-69-99-94*(86*62)*48+20+60': -24061409,
        '12-66+78-18*45+1+25+80+67+10+86-73-25*14*26+74*11+88-45*25': -9913,
        '87*61*98*31-31*44+(51+32-12-90+(17-95-59-51-42)+31*31+64+(4*43))': 16122250,
        '(93*0*(9+99+92)*41-46*16)*26*32+63*25-28+21+86*58-99*(18-86*31)': -343644,
        '10*76+15+(30-19+55+7-64-34)-14-8-75+42+38-76+7*8+8*30+(40)': 993,
        '37+(33-74-88+71+(42+(64-92-48)-11+0-(39*13*75-23-69*(4)+60+6-95)))': -37763,
        '((17-56*36)*17*97+92-40-32-15)*59+39-(9*92)-9-(88-95*(62+38-(54-14)))': -194479600,
        '((89*43)+74-3+32*90*5-44+60+76)-10+17*72+25+31-(55+89*11-88-6)': 18720,
        '((21+81)+10-86+76+78+53-96-(69*39-90*67+87*62)-71-32-48)+58*42-5': 362,
        '92+16+63+71+97*14*33*21-66-(4)+6*(12)*80*7+(30-73*98*14)*20*30': -59094014,
        '59*39+61-72*(99*17*88+77-60)+78+91+85*70-80-25-76*62*(27-83*82)': 21286312,
        '(89+3+99-5+54+88*77-87*71*68-14+23-24+38)-19-1-47*39+44-92': -414898,
        '(61-43+80+54*64*6+24-67+96*51)*62*(26)-95*8-27*94+88-12+48+99': 41404369,
        '(86*93-79+42-1*72+62*12-(29)*31)*63+39+(37*18*29+84-48-64-88+72)': 506551,
        '(2-81-(23+54-52+(34+36-85*24+17)+39-62+22+26)-88+1+19-94)*17-93': 28161,
        '29*9+61-(36+47)+21+(25-5)*69+90-42+69*(87*70-32-(9+25*69*89+27))': -10176019,
        '(74+40)+29*7-(26+81-49+61*4-16-88*84-68*66+77-43+(5-91)+14+27)': 11922,
        '79*(31*(30)-75)-33*(61+(31+(21*53)-88-(12*(52)+24-(57)+86)*6*(10+(65)-5)-14))': 9414366,
        '((((19*22-74*(67)+47*17)+68)*81*23)+59*25)*15-(18*(9*(77*(62)+27*(6)-4-92)))': -103403940,
        '(((((98+(11)+61)-91+(92*(28)*89*(94)+51)'
        '+60)*82)-82*(32+79-(88)*33)+15)+40)+57*(53)': 1767414594,
        '(52*(74)*24+38+(4*38-(40+(24)+23)*78-(26-49)-28-22*(90)*55)+38+49)-2*(30)': -23122,
        '((88-16-46)*5)+28+(16*(19-(18)*47*'
        '(15-(34*64-(35)-79*49-(65)*70-(31*(93)-76)))))': -123204210,
        '((97*24+(29)+5)*71)+59*(29*(87)*43+(84*(40)*29-75)*10+(31)+9+(8)-72-(1)*63)': 64008770,
        '(((14+77)-60)*93+33+(91+76-22)-99*(97)*15-(61+(78)*69)-40)+54+(54*(7*(62)*87))': 1892519,
        '25+58+(15+79*(75-4)*87)-53-(76*(12+(33)*98+(38-(89)-75*(23-57-38)-14+(91))))': -171044,
        '((((51*6)-7*(10)-44)+33-(3)+71-(87-(10)+46-(40)-76)-25)+85-(24)*89)*3-(92)*48': -9786,
        '((((((40+32)-98-13*10)-78)+42)+63-(7)*3)-4-67)-86+(19)*38-(98-3+(46)-80*(2))': 434,
        '((37*(94+66-(71)-19-(48*(29-94-(8)-81)*34)-28+36)*75)-96)+97*(81)-95+(4+(57))': 697659377,
        '(80*57)*80*20-(13)+89-10*(78)*84-'
        '(53+92+73*(57*14+(34)-54)*0)*12+(49+(91))': 7228956,
        '11-(5*(51*(66*(91)*80-(86*(6)-38+'
        '(88-95+(81)-89+(21)-86-54*(91-(49*(37*25))))))))': 500451281,
        '((((22*(71)-3)*3)*51)-10+91+(47+(80)-46)*13)+51*(79-(36+(62*(9)+91+57*7)+16))': 187590,
        '(48+60)+10+75*(86+(39+(27)*73-11+57*(28-(43)*49)*70-(81)*88-(71*24)+39)+36)': -622641032,
        '((((64*(96)*51)+64)+37)+23-(11-(95)*10+(30)-2-87-(46)*1+(5)+53*47)+12)*21+(72)': 6552660,
        '((60+57)+1+(95+(84)*32)*61-35+(17)+0)*56-(18*(71-(5)*79)*6*(69-(46+(3)-75)))': 12836568,
        '((((83+31)*38)-41+43)+32-(1)+78)-63+'
        '(93*(7)+66*(64*(84-(34-(90+(20)-49-(44)*3)))))': -83673,
        '60+(23-(62)+2*44-82+(30-(56)+55*(34-(48)-14)-76+(5)-59)+29+(66-(66-(75+26))))': -1539,
        '(((93*(58)*28+(73)*48-98*(68)*19-(48)-96-32)*34)*91)+71*(72+87-9)-56-56-(76)': 85850398,
        '63-(11)*33*(41*16-(74)+64-78-(31+'
        '(38+(63-(99*(71+42+(87-5+(88-(35)-71*(37)))))))))': 85335918,
        '(32*18)+76-55+(59*(76)-63+80+(28*(35*(7+88*(81-(89-(7*(1)-3)-74+(76)+54))))))': -5162442,
        '(84*(5)*54+(62*(58*15)*86)+68-63*(99-(48)-66)*82*(72)-74)+95*(67)-9-23*13': 10246851,
        '((((((((58+16*13)-27+(79*76)+77)+54)'
        '*76)+94)+11)*23+91+(72)+80)-23)*33+(2)*63*(38)': 367769559,
        '81-(43)-73-(8)*26+(11-(4+(92)-76-87*(32-(8)-74)-36*5+(33)+87)+99)*87*(27)': -9866043,
        '((18+0*(80)+58-(45)-21*63*(19)+32)+14)-52+73*(7)+31*(1+(18+(97)+67+(75)+32))': -15611,
        '((16+31+67+(73)*94-(24+(70*(44*(6)-5)-68+(89)*84-52)-69)*41)-17)-27*(14)+19': -1036481,
        '((((((1*88)-55)*4)+49-16)-11-(90)-89)-25*(3)-88)*82-(90*(67)+15+3-(4*46*88))': -5272,
        '(77*17+1)-95-(81-(96+(80-30)+11-50)*41)*32*(93)-4+(90-(87+(62)*0)+58+(57))': 12815985,
        '68-(75*(97+(86)+45-(79-(6*(80+(60*'
        '(58+(89-96)-71*88+47-(8*(93)-15+21-(61)))))))))': 184605893,
        '(((((62+63)*56-82)-86*(89)+4)*28+(26*(25+65)*50+(41*(31)+19)-62)-1)-36)-76*(22)': 96023,
        '((3+82-(20*30)-75)-6)-70+(49+(38)+80+(97+(0)+7*(94)+48+(18*(22)-43)+33)+83)': 773,
        '((43*93+64*(96*(26-(57)-13)+19)*86)-53)+77-21-(33+(26*49*(92)+5*(19+(4)-67)))': -23257339,
        '74-(63-(96*(92)-25*(94*39+75)-75)*62+47)+88-(74+(99*(87-(53)+99+93+66)-29))': -5284517,
        '(39*98)+73*(85-(75+(99+(15+(5+(23-'
        '(75-(12*(99*(18+(91)-64+(72)-49)+68)+87)+69)))))))': -5958453,
        '(((54-(89*(72)+14)-74)-34)*53)-92-'
        '(66-(26+(31+(11+85+(30+(33*(47+(55)-29)-4)*56)))))': -208523,
        '(((34+55)*83*(89)*28)*15+27)+51-'
        '(14-26-(51-(39*(56-(33)+16-(37)-14-(16)*13)+2)))': 276134779,
        '32+(98+(98+60*(1-(88)+52-65*(85*(29)+48)+91-(67)*3-(82)*76)+19)*20)-16+(31)': -203663915,
        '((34-(68)*24)*15*(36)+78)+41+'
        '(62-88-2-88-(54*(46)-38+(27*(40+(87+(28)*33*(59))))))': -2340724,
        '((6*85)+71)+14*38+91*(57+(42+(13-(64-42)-71+(56*(69)*98*(1)-5-(14)-19-(60)))))': 34453076,
        '23*34-(83-(96*(82)-65-(22+(68)+90-(2-(79*(45)+3)-67)*87)+51-61*52)-34)+4': -309958,
        '((((((((2*33)*98)+55-(9)*59-(39+5)+24*(40)+56)+54)+16)+7)+28)+1-(42)*2)-40+(3)': 6949,
        '(7-(55)*31+25)*68+(91)*76+(90*(14-(15+(20-77*24)+46)+44*(13+(52-(83)-99)*83)))': -42623478,
        '((93+49)*39)+52+(5)+32+29*(25-(95+(97*(29)-56*(60-(14)*15+(86+13)*51)+2+59)))': 7876227,
        '(((98-(23-(65)-88+72)-39-93)+61)+93+(27-(5*(44)+25-17+(45)+21)+30)+13)*89*(6)': -24564,
        '(31*20)+88-74*(71+(96+(64+26)*66-13+(12)+77*(0)-90)-9+(79+74*(93)-81)*11)': -6044130,
        '62-(12*(98-(78+21)-76)-57)*42+18*(70)-83*93*2-47+(92)+55*(7*(67+(55+22)))': 82571,
        '74-(28)*69+(76)*82*79-(98*(13-44+(40)+8+(26*(20)*24+(76+(47+(19)-75)-67+21))))': -736294,
        '(((0+(70)*99)-39*(4*63-(82-(18)-6+(88)-54-64)-61)*53-64)*38)*26+(89*(50)*77)': -325751690,
        '(((((17+5+13)-5)+48)*22-91*(92-23)+57)-47)+36*(18)+30-(15+(83+37+(8)-66+(56)))': -4008,
        '((92+(32)+66-(51*16*(66)-18)*39+61)+92)+9*39-(99*(53+(58+(86*98)-31)+28+(28)))': -2946824,
        '53-(97+(63)-38-45*(23)+30*(61*'
        '(97+(28)*17-(77-14*(9*(12-(38-(19+70)+64*(57))))))))': 825722586,
        '(((((((((45+18)*41)*61+24)+57+'
        '(82)+74)+56)*34-(74)-98-59)*98)+16)-11)*3-(42)+79*(31)': 1577863084,
        '(((13*97+46)+96)-32-49)-4-(63)*6+(84)+50-(35+(57+(37*(56)-30-(82*(53)*9)+76)))': 37978,
        '((23*48)-74+81)-78*(73-(39-53+(52+(63+(4)-52*(9)+83)-24*(58+(53-(15+(18)+47))))))': -84455,
        '((((6+54)*24*43-(80+70+(8)-92-(88)+27)-99+(59-80)*14)*21)-30)*43+92*95*(24)': 55762836,
        '93-(92+13-(85)-7*(70-(85*(16)+41+(59)-75*(57*(34)+0+18)+27+(64-(22-(5*(73)))))))': 1014205,
        '(((((((((63+64)-96)*46)+74)+36)'
        '+99)-38)-9-(48)*24+(30-(6)-59+(93)+89)-56)*46)+17-(39)': 24220,
        '(((40+39)+7+(27)+24*45)+78)-2+(90*(75)*83)+52-(89+(94+(0+0+(78+46)+28)+88))': 561148,
        '(((58*71*(94)+77*(99*(74)+79+24)-19)-43)-84)+33+(27+(5*(55-(34+50)+78*(71+37))))': 1001014,
        '(40+75*13)*35*(56+(89)+55)+75-(52+(6)-99-(17)-25)+32+(8)+0+68+82+(41+(32))': 7105421,
        '(6-37)-79-0-(53)+39*(61-52-(13-(15)-96)*25+(29*(85)+60-21)+59*(56)+27+(9))': 323654,
        '(((((96*77)*99)-42)-7)+84*('
        '46-(99)+55)+81*(85+(41*(0)-21)-20)*44)-46*(94*(64+(72)))': 300679,
        '((((14*(31*60)*33*(8)-34*(65)+66*(31)-11*17-(8)-95)-55)+81-58+(41)*90)+2)+48': 6877814,
        '((((((4*81)*23*33)+53)-52+(12)*98-28-(1)*68)-18)-17*(87*46)*73)-32-(31*(16)+66)': -4720097,
        '((((((26-5)-62*99)+42)-50)*25+(32-(79)*36*(2*(10)+20)+22)-62)+64)+93*(97+90)+26': -249412,
        '((98-67+(29)+8+(45+(27-25)+61)-19)-51*(41*(79)+71*(25)-78)*92-96)+89+81*(13)': -23158509,
        '64*(0)*83-(48+(26)*57*(95)-26*(80)+98)-38-(61)-75*(29+(67-(44)*8)-41)*16+(15)': 217460,
        '((5*(23)*76+(60)+46)-18+(49+(63)-8)'
        '*27+93)-47-(47-(37-(81+(75+(29)+27*(48*(25))))))': -20913,
        '93+20-51*(67-(40+96*(32)*16*41)-14+(64)-31)-16+(23-(72*(90+76+88)-55)*90)': 101133636,
        '45+90+(16)*35-(29)+57+(66+57+98+(56+(28)-86*(65)-29+(36-(66)*86)*8+1)-44)': -49754,
        '((85-(91)*43)*26*(5)*98-(32-(53)*99-(83+(5-7)-63)-2+(94*(44)+53)-44)-33)+40': -48767623,
        '(52+91*(11)*78-(90*(29)+56-(18+(22)*15+(70-23)*55+(78)*8)+73)*79-(64)+2)*90': 12842100,
        '(64+87+(49)*68+(29-(24*(1)+60*(0)*29)-57)-61*(13)+6)+1+(21)+20+22-(75)*32': 308,
        '70+88-(82*81+40+(8*(81*73-(72*76)+86)+1+(68)*92+(71+(48)-73)*14*(12*63)))': -503861,
        '7*(74)-35*(47-(17-(89)+81*(23)-66-(79-(8)-22+(15)-61)-21*(47*(16)*27)-15-21))': -14865557,
        '((48*75)+54)+96*90+(40-(23)-62)*0-(20)-16-(50-(43)*97)-33*(52+(7+(3)+11-(29)))': 14927,
        '((29-79)+76+(25)-2*(60)-77-4)+38-(96*67-(7)*13-(80*(57+(24*(64*13-(95+(69)))))))': 1280667,
        '97*(89+(99)+93)+22+(22+(84+(88+(85)*67-90*31)-4-(74-(88+63)-29+(94)*53+(56))))': 25442,
        '82+48*(90)+57+(67-(60*(67*(51)+46+(40-(99-(35-84)+22)*77)*36)+32*(82)-59)+11)': 27982192,
        '51*24-(43+24+(35)+68)+35-67*(73-86+(30*(97)+60+(45-(10)-35-(17*(92)-59)+4)))': -96463,
        '((7*(72)+13)-57)+35-(69*(66)+60-79)*11+(77)*48+(41)-77*(64+(90+(57)*11)*2+(52))': -165003,
    }


def test_basic(builder, input_data_basic):
    for i, (input_equation, reference) in enumerate(input_data_basic.items(), start=1):
        builder.lexer.analyze(input_equation)
        root = builder.parse()
        output = root.evaluate()
        assert output == reference, input_equation


@pytest.fixture()
def input_data_division():
    return {
        '9/7/5': 0.2571429,
        '((17/33)-21-40-44*7*91-49+91/37+42)/88/36-28/(1-(14-(10+79*(5/96))))': -33.9892432,
        '58*25+19*82/(64*13/(74-64+22/82/95)+8*15-85)+32*29/27/60-86/45': 1461.8453974852,
        '((68+61)-61/12)+64*37+(50+3+8-27+80)-53/57/8/84+(67)-83-45*35*16': -22610.0847170008,
        '(12+91-76)*30/(65-(21*88/57*26*43)-18/4+95)-78+77*94+5-24/87*5': 7163.59824653405,
        '((61/45-40)+12/95+33+40)*8*26/13/45*(23*(47+37/38*50+43*28-99+46))': 351546.348362915,
        '51*80-72+89+9/(50/10+11-65+34-5+27+44-30/33-52-(83/53/14/20))': 4092.29948520731,
        '86*4+76*(25+95/94)/58+37-50+50*37/39/92*39+88*45-66-68/68-68': 4210.19160100801,
        '23*88/96-55+(95/68)-52+(4-38*39-68*6+79-84-(84*34-74/61/50*88))': -4829.38452587592,
        '((69+86-79/70)-25)*30-(2/24-9*42*57)-93*67-13*22-94-(55/87/40)/64': 18801.0592768627,
        '(((80*90-26-86+31*39)-1*29)-28)*33+86-39+84-76+70/(27+98-72-49*71)': 271974.979568009,
        '(91/80-84)+87+21*43*3+5-13*54-20-(39-87-5+92+67+3-2/27*(54))': 1891.1375,
        '(56*76)*48*91-1-39/84-17-90/(64/(96-13+(83*(14-43-86*(15/51)-12*74))))': 18700056.2085084,
        '42*(24-(55)*98/20+13-44*83-12-35-44-(88*50/86/5/78/84/28/24/56))': -166971.000001743,
        '(((29*95-68*(17*54)*40)*23)-78/19+4)*80-38+(85+58/82*15)*20*76/76/49': -4589337207.39666,
        '14*(36/21-27)/49-64+97+96-24*39*54-65+64/89-44*61/21-98-21*95': -52707.3149124818,
        '(((9*95+97)/35)/81/90+87*87/(63*87+97/4*20-17)/29+88/62+3)*56*71': 17760.6285747666,
        '(17-69*15/53+51-15-69-22-4/7+16+15+25)+50*(56+99+80-26-28)+2': 9049.90026954178,
        '77-83*(52)+65-(54/76-38+37-76*2*22-(35*25+72/33*0/97+22*54+82))': 1315.28947368421,
        '(((38+19-28-53*33/10-57/33)*19)/78+92)/1/38*(48+52*9+35-53/89+(96))': 953.268195878633,
        '62-49*(14*(14*78+60+(49*21*32+35*32-33/48+75)-30+38/98)/53)+50+63': -456011.120283019,
        '49-12-0+45/(45*(51/93*94*17/17/37*63)/48)-48+75*(67-83)*66/85+(9)': -933.217831813576,
        '88-(78+32+(13)+33*17+(57*63*(29)'
        '-58/83/71)-57-(44-94/15+17)-18/(63+24))': -104623.049927929,
        '(22/67/99*5+44)-19/46*42-84-25/99*(5)*3-17-38+85+67/35-41-(42)': -112.204835412623,
        '(41+71-49*(55)/54+38)/35/14-(0-12/29/91/58+(17*(33/60/7*98/(48*91))))': 0.174381048012567,
        '34+90*66-64/(8+(10+(81+13+17/54+44)*87+(79/16+84*27*64*72+96+46)))': 5973.99999388329,
        '77/(10-68-95-82+41+36+6-87/92+53-4-52+95-34*7+4*2+62/50)': -0.265787013205307,
        '(((41+30)/6-17-(19/52)*91)+78/94*41/52*61*12/84*28)-67*(13+50-37*42)': 100018.221631206,
        '(78/48*34+58)-17-28+50/54+(40/1/13*13-(54+66)-44/23-61+52/(33*(68)))': -73.7139446468091,
        '78+85-27-28/(24*64+(37-47*(78/(80)*13'
        '-(37-80/44/24+20/(55+(33/86/24))))))': 135.989742839566,
        '69-30-17+35/(62*73/45/84-23/43*72+74*78/23-(67*37+78+9+11*82))': 21.9892452,
        '10+29-26*(5-(81/(1*96/27)/89*41+94/91+81-95+91*82*30/29/86)/22)': 12.1575087557285,
        '((57-81/65/13-41*7-32*5)*5)*28-(64-97-(32)*5*9+35-(3*(78*93+80)))': -31173.4201183432,
        '99*40+(4/94-16/27/43-28/(98*(50/18+(85+5*22*77-1-81*31*61/61))))': 3960.02872470992,
        '(69-97/83+23-23)-52+26*(26-36/40-90*58)/1*73/75+33+17+83+8-68': -131376.771341365,
        '((11+(59*44-27*76/(8*86-30)-29*27/62)*56/22*96)/14-8)*45+78/41+58': 2026406.25656019,
        '(46/(24*76)*55*67/20*(84/94-75-77-48)*3*10/30*89/71+30+76/19)-49': -1174.73118401995,
        '59/4-6/64-58+65-86-91+62+7+(37*67-34-59/92*23+58)/7*12/2': 2046.44196428571,
        '29-50+88-(86*13-68/50*38*16+6*54*14*5)*20+98*15-3+98-46-(15)': -457851.4,
        '(((66/76*88-53*37*86*93-75)*10-41/12)+76+82)/26*48*71-88-71*(97/99)': -20558184887.9705,
        '(40+56-(69-25+47+16*49*78*75)/22-60-(25/92/20*52-36)/67+37)-26/4': -208409.8368680,
        '44-14-80+32*27-18*9-(75-31-29-(11/33)+75-58-70+27+4-28+52*81)': -3524.66666666667,
        '99*33*12*33+37+(81/80-66*46-61*13-73/58/46+(95*96-(14*81*17+68)))': 1279714.98513868,
        '((((91/48)/57)-55)*13)/9/'
        '(47/55/94+61+7+65/36)-94/59/44-70/(53-(91*83))': -1.16412185387075,
        '13+97*47*36+29/(78/79/(68-9)-65/(62-81-37*(42/63+(26)+61-21)+9+7))': 164810.573541647,
        '((((51/19)-53)+66*7*(31/7)/46/53*6-43/1*58+28)*3)+31-94-59/2-(97)': -7723.34154397479,
        '(((46-86-20*15*28*65*82+44*8+97/29)+41)/93*38+48*66*28)-66/29*(44)': -18205186.0185391,
        '12*57-(80)-87-(74/(40/(34)+3+19-61)'
        '/13/(34-32/67-(95-2-(26*20/(46*41)))))': 516.997457911305,
        '((71/50/84/27)+74*(62/50/30/60/28)-29/37)+67-22*(60-40-41*82*6)+95': 443505.218662953,
        '4*13/81*85*76*(41*43*65-51/99)*75-73-39-(5/51+30*34)*77/30/34': 35643128839.051,
        '(89*26+35+89/18*49*62/33-9)-28/1*90+61*45*90/(13-91*22)/56/9': 274.942107456814,
        '((61/90/91)*8-29)-38+97*(65-1*9/85-85*46+73/37-40+82-72)/6/22': -2913.10626521509,
        '(69/20*58)+59*64-59/83+(4/29*67-66-55-87*45+71-83*10+(20*(19+80)))': 1169.63053593685,
        '(((81-94*75)*96+67-31/92*30*82-15*(35-43/33)*92+26-25)-7)*67+59-69': -47991689.9920949,
        '24*72-72+35/11/39*48*78*72/68/84+15+14/(96-(57+(13-1)/8*95-71))': 1674.41949814891,
        '(20/61)-79+(87+(9*(9-61-46*98/(6*76-68*3*15*11+93*70*79)/98)*70))': -32751.7323698575,
        '(23/54*1-69)+64/(92*92-61+86*(24+(82/66/77*20/24+(62*75/33/74-99))))': -68.5438556836318,
        '((17-82/75-(95)+12-(52+53+87/91+19/52)+95/41)-39-29+43+23*42+37)-69': 737.90231126597,
        '((((75+36)*62-11-75)+29-37-(61+19*77*78)*33/69-37)*12)+0+93*20/9*88': -556066.550724638,
        '89+58*62*64/6+70*19+60*11/85-29-42-96-86+83/58+(34-30/74*17)': 39559.6371818066,
        '(86+38*31/37+18)+1-96*36/54/65-16*13+83*32*89*(75-23+5-88/99)': 13263696.7421113,
        '46*87-0/17/2-70*(38*92*39+28-(12/(27/77+47/81-42+63-(19-32/(85)))))': -9541784.02152181,
        '75*91*61*48-(70/(17*80*(99)-31/(30/10+74*9*38*31/65*29-9/3+89)))': 19983599.9994801,
        '((((49-60*52-1-43*68*96+91+74)/35/34/7/25)*72-11*18-3+54)/61)*54': -216.934097022416,
        '(((77+81/42*7/(41+48/92)/46-19)*60/41-8)*98/38)+67*26-55-(15/28-65)': 1949.75540266514,
        '(((42-55)+54+27+84)*61)/77/1/45/68*38*53*54-23+86*(39/92)-5-(75-1)': 4214.16805726243,
        '19*6*34+3/30-13-(8*46/58+53-84+(14*93)*42/23+52/76-6-54/49)': 1516.6077853125,
        '93*14*15-24/41*61-94-(41)/47+96*1-75+74*(99+0-78/93-19*12+33)': 12254.3558263723,
        '71+(25*67*25+39-72/50+(65*42*68)-73)*42*66+(66+90*(40*54+43*(27/34)))': 630770950.555294,
        '80/31-55-79/66/58/(92-61-69*70/(63+66-12-26*42-90+54+(18*23-7)))': -52.419884047964,
        '93-(75-(91-36/95)-30-47+72-(51+54-83-86+96+9*15-0)*53*74-40-(63))': 655190.621052632,
        '((20+27+48-84*3-18+91*21-10)+40-69)-37/47-54+22-82/54-68-91/49': 1592.83710458179,
        '17*70-39-(73-60*10+76/55+86+63*61-53-42*57/87*81/75*32-92/15)': -1242.25262277952,
        '((52-84*14)*17*(76)+19)+42-(59+5-29+91/91-77-(95/55*88/38+6-1)-96)': -1452001,
        '((93-48*0+(59)/38+46/(41)*32-2+97)/85/1+41)-85/67/97+24+(95*85/98)': 150.037292843786,
        '(30+60)+17/(71/18-99/72/28*(21/85/91/22+31-26*(52*59-38/40*89-27)))': 90.004500717841,
        '83*80-18+48/34+65/2-5*(95/62)+54/34+(30-69)+40/(81-51-72/95-43)': 6607.93128810129,
    }


def test_basic_with_division(builder, input_data_division):
    for i, (input_equation, reference) in enumerate(input_data_division.items()):
        builder.lexer.analyze(input_equation)
        root = builder.parse()
        output_python = eval(serialize_to_python(root))
        assert pytest.approx(output_python) == reference, input_equation


@pytest.mark.parametrize('text_in, reference', [
    ('1', 1.0),
    ('2', 2.0),
    ('2.5', 2.5),
    ('2.5 + 0.1', 2.6),
    ('1 + 1', 2.0),
    ('1 + 2 + 3', 6.0),
    ('1 * 2 + 3', 5.0),
    ('1 + 2 + 3 + 4 + 5 + 6', 21.0),
    ('1 + 2 + 3 * 4 + 5 + 6', 26.0),
    ('9 - 8 - 7 - 6 - 5 - 4', -21.0),
    ('1 * 2 + 3 * 4 + 5 * 6', 44.0),
    ('1 / 2 - 3 / 4 - 5 / 6', -1.08334),
])
def test_simple(text_in, reference):
    assert custom_eval(text_in) == reference


@pytest.mark.parametrize('text_in', [
    '(1)',
    '(1 + 2)',
    '(1) + (2)',
    '(1) / (2)',
    '((2 + 5) * 4) - 2',
])
def test_parenthesis(text_in):
    assert custom_eval(text_in) == eval(text_in)
